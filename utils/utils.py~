""" Utilities for Computational Assyriology """
import requests
import tqdm
import os
import errno

def make_dirs(x):
    """Check for existence of directories
    create those if they do not exist
    otherwise do nothing. Parameter is a list
    with directory names"""
    for dir in x:
        try:
            os.mkdir(dir)
        except OSError as exc:
            if exc.errno != errno.EEXIST:
                raise
            pass

def oracc_download(x):
    """Downloads ZIP with JSON files from
    ORACC server. Parameter is a single string
    with ORACC project names, separated by commas"""

    p = x.split(',')
    p = [x.strip() for x in p]
    CHUNK = 16 * 1024
    for project in p:
        project = project.replace('/', '-')
        url = "http://build-oracc.museum.upenn.edu/json/" + project + ".zip"
        file = 'jsonzip/' + project + '.zip'
        with requests.get(url, stream=True) as r:
            if r.status_code == 200:
                print("Downloading " + url + " saving as " + file)
                with open(file, 'wb') as f:
                    for c in tqdm.tqdm(r.iter_content(chunk_size=CHUNK)):
                        f.write(c)
            else:
                print(url + " does not exist.")
